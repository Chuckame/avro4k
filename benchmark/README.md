# Kotlin Avro Benchmark

This project contains a benchmark that compares the serialization / deserialization performance of the following avro libraries:

- [Avro4k](https://github.com/avro-kotlin/avro4k/)
- [Jackson Avro](https://github.com/FasterXML/jackson-dataformats-binary/tree/master/avro)
- [Avro (using ReflectData)](https://avro.apache.org/)

Each benchmark is executed with the following configuration:
- Reading from a prepared byte array
- Writing to a null output stream
- All with the exact same schema generated by avro4k
- Generating a maximum of use cases:
  - nullable fields
  - unions
  - arrays
  - records
  - enums
  - primitives (string, int, float, double, boolean)
  - logical types (date, timestamp-millis, char, uuid)
- not benchmarking uuid as jackson uses a different representation (fixed) than avro4k and apache avro (string)

## Results

Computer: Macbook air M2

```
Benchmark                                    Mode  Cnt      Score       Error  Units  Relative Difference (%)
Avro4kBenchmark.read                        thrpt    5  21443.935 ±  2215.328  ops/s    0.00%
ApacheAvroReflectBenchmark.read             thrpt    5  19803.543 ±   485.869  ops/s   -7.64%
Avro4kGenericWithApacheAvroBenchmark.read   thrpt    5   8836.787 ±   404.874  ops/s  -58.79%

Avro4kBenchmark.write                       thrpt    5  50565.556 ±   849.344  ops/s    0.00%
ApacheAvroReflectBenchmark.write            thrpt    5  46872.768 ±  2406.622  ops/s   -7.30%
JacksonAvroBenchmark.write                  thrpt    5  32349.182 ± 10105.111  ops/s  -36.01%
Avro4kGenericWithApacheAvroBenchmark.write  thrpt    5  27471.887 ±   315.498  ops/s  -45.67%
```

> [!WARNING]
> JacksonAvroBenchmark.read is failing because of a bug in the library when combining kotlin and avro format.

> [!NOTE]
> To add the relative difference, just ask to chatgpt "can you add another column in this benchmark that indicates the relative difference in percent regarding
> Avro4kDirectBenchmark:"

## Run the benchmark locally

Just execute the benchmark:

```shell
../gradlew benchmark
```

You can get the results in the `build/reports/benchmarks/main` directory.

## Other information

Thanks for [@twinprime](https://github.com/twinprime) for this initiative.
